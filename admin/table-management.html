<!DOCTYPE html>
<html class="light" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>DineFlow - Table Management</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#ff8000",
                        "background-light": "#f8f7f5",
                        "background-dark": "#181410",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24
        }
        
        .notification-toast {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body class="font-display">
    <div class="relative flex h-auto min-h-screen w-full flex-col bg-background-light dark:bg-background-dark group/design-root overflow-x-hidden">
        <div class="flex min-h-screen">
            <!-- Sidebar -->
            <aside class="flex w-64 flex-col border-r border-solid border-gray-200 dark:border-gray-800 bg-white dark:bg-background-dark p-4">
                <div class="flex flex-col gap-4">
                    <div class="flex items-center gap-3">
                        <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10" data-alt="DineFlow company logo" style='background-image: url("https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=100&q=80");'></div>
                        <div class="flex flex-col">
                            <h1 class="text-gray-900 dark:text-white text-base font-medium leading-normal">DineFlow</h1>
                            <p class="text-gray-500 dark:text-gray-400 text-sm font-normal leading-normal" id="restaurantName">Restaurant Admin</p>
                        </div>
                    </div>
                    <nav class="flex flex-col gap-2 mt-4">
                        <a class="flex items-center gap-3 px-3 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg" href="dashboard.html">
                            <span class="material-symbols-outlined">dashboard</span>
                            <p class="text-sm font-medium leading-normal">Dashboard</p>
                        </a>
                        <a class="flex items-center gap-3 px-3 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg" href="menu-management.html">
                            <span class="material-symbols-outlined">menu_book</span>
                            <p class="text-sm font-medium leading-normal">Menus</p>
                        </a>
                        <a class="flex items-center gap-3 px-3 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg" href="order-management.html">
                            <span class="material-symbols-outlined">receipt_long</span>
                            <p class="text-sm font-medium leading-normal">Orders</p>
                        </a>
                        <a class="flex items-center gap-3 px-3 py-2 rounded-lg bg-primary/20 text-primary dark:bg-primary/30 dark:text-primary" href="table-management.html">
                            <span class="material-symbols-outlined" style="font-variation-settings: 'FILL' 1;">table_restaurant</span>
                            <p class="text-sm font-medium leading-normal">Tables</p>
                        </a>
                        <a class="flex items-center gap-3 px-3 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg" href="billing.html">
                            <span class="material-symbols-outlined">credit_card</span>
                            <p class="text-sm font-medium leading-normal">Billing</p>
                        </a>
                    </nav>
                </div>
                <div class="mt-auto flex flex-col gap-1">
                    <button id="logoutBtn" class="flex items-center gap-3 px-3 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg w-full text-left">
                        <span class="material-symbols-outlined">logout</span>
                        <p class="text-sm font-medium leading-normal">Logout</p>
                    </button>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="flex flex-1 flex-col">
                <header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-gray-200 dark:border-gray-800 px-10 py-3 bg-white dark:bg-background-dark sticky top-0 z-10">
                    <label class="flex flex-col min-w-40 !h-10 max-w-64">
                        <div class="flex w-full flex-1 items-stretch rounded-lg h-full">
                            <div class="text-gray-500 dark:text-gray-400 flex border-none bg-background-light dark:bg-gray-800 items-center justify-center pl-4 rounded-l-lg border-r-0">
                                <span class="material-symbols-outlined">search</span>
                            </div>
                            <input id="searchInput" class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-r-lg text-gray-900 dark:text-white focus:outline-0 focus:ring-0 border-none bg-background-light dark:bg-gray-800 focus:border-none h-full placeholder:text-gray-500 dark:placeholder:text-gray-400 px-4 text-base font-normal leading-normal" placeholder="Search tables..." value=""/>
                        </div>
                    </label>
                    <div class="flex flex-1 justify-end items-center gap-4">
                        <button class="relative flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full size-10 bg-background-light dark:bg-gray-800 text-gray-700 dark:text-gray-300">
                            <span class="material-symbols-outlined">notifications</span>
                            <div class="absolute top-1.5 right-1.5 size-2.5 rounded-full bg-red-500 border-2 border-white dark:border-background-dark"></div>
                        </button>
                        <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10" data-alt="User profile avatar" style='background-image: url("https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=100&q=80");'></div>
                    </div>
                </header>
                <div class="flex-1 p-10 bg-background-light dark:bg-background-dark">
                    <div class="flex flex-wrap justify-between gap-4 items-center">
                        <div class="flex flex-col gap-1">
                            <p class="text-gray-900 dark:text-white text-4xl font-black leading-tight tracking-[-0.033em]">Table Management</p>
                            <p class="text-gray-600 dark:text-gray-400 text-base font-normal leading-normal">View, manage, and generate QR codes for all your restaurant tables.</p>
                        </div>
                        <button id="generateQRBtn" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-5 bg-primary text-white text-sm font-bold leading-normal tracking-[0.015em] gap-2 shadow-sm hover:bg-primary/90 transition-colors">
                            <span class="material-symbols-outlined text-base">qr_code_2_add</span>
                            <span class="truncate">Generate New QR Code</span>
                        </button>
                    </div>
                    
                    <!-- Tables Grid -->
                    <div id="tablesContainer" class="mt-8 grid grid-cols-[repeat(auto-fill,minmax(280px,1fr))] gap-6">
                        <!-- Tables will be loaded here dynamically -->
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Updated Add Table Modal -->
<div id="addTableModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white dark:bg-background-dark rounded-xl p-6 w-full max-w-md">
        <h3 class="text-lg font-bold mb-4">Add New Table</h3>
        <form id="addTableForm">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Table Number *</label>
                    <input type="text" id="tableNumber" class="w-full p-2 border rounded-lg dark:bg-background-dark dark:border-gray-700" required placeholder="e.g., 01, 02, A1">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Capacity *</label>
                    <input type="number" id="tableCapacity" class="w-full p-2 border rounded-lg dark:bg-background-dark dark:border-gray-700" required min="1" max="20" value="4">
                </div>
                <div class="flex gap-3 justify-end">
                    <button type="button" id="cancelTableBtn" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90">Add Table</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Updated Edit Table Modal -->
<div id="editTableModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white dark:bg-background-dark rounded-xl p-6 w-full max-w-md">
        <h3 class="text-lg font-bold mb-4">Edit Table</h3>
        <form id="editTableForm">
            <input type="hidden" id="editTableId">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Table Number *</label>
                    <input type="text" id="editTableNumber" class="w-full p-2 border rounded-lg dark:bg-background-dark dark:border-gray-700" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Capacity *</label>
                    <input type="number" id="editTableCapacity" class="w-full p-2 border rounded-lg dark:bg-background-dark dark:border-gray-700" required min="1" max="20">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Status</label>
                    <select id="editTableStatus" class="w-full p-2 border rounded-lg dark:bg-background-dark dark:border-gray-700">
                        <option value="available">Available</option>
                        <option value="occupied">Occupied</option>
                        <option value="reserved">Reserved</option>
                        <option value="maintenance">Maintenance</option>
                    </select>
                </div>
                <div class="flex gap-3 justify-end">
                    <button type="button" id="cancelEditTableBtn" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90">Update Table</button>
                </div>
            </div>
        </form>
    </div>
</div>

    <script type="module">
        import { AuthService } from '../js/auth.js';
        import { TablesService } from '../js/tables.js';
    
        class TableManagement {
            constructor() {
                this.user = null;
                this.restaurant = null;
                this.tables = [];
                this.init();
            }
    
            async init() {
                // Check authentication
                this.user = await AuthService.getCurrentUser();
                if (!this.user) {
                    window.location.href = 'login.html';
                    return;
                }
    
                console.log('User authenticated:', this.user);
    
                // Load restaurant data
                await this.loadRestaurantData();
                
                // Load tables
                await this.loadTables();
    
                // Set up event listeners
                this.setupEventListeners();
    
                // Set up logout
                document.getElementById('logoutBtn').addEventListener('click', this.logout.bind(this));
            }
    
            async loadRestaurantData() {
                try {
                    console.log('Loading restaurant data...');
                    this.restaurant = await AuthService.getRestaurant();
                    
                    if (this.restaurant) {
                        console.log('Restaurant loaded:', this.restaurant);
                        document.getElementById('restaurantName').textContent = this.restaurant.name;
                    } else {
                        console.error('No restaurant found for user:', this.user.id);
                        this.showNotification('No restaurant found. Please contact support.', 'error');
                    }
                } catch (error) {
                    console.error('Error loading restaurant data:', error);
                    this.showNotification('Error loading restaurant data: ' + error.message, 'error');
                }
            }
    
            async loadTables() {
                try {
                    if (!this.restaurant) {
                        console.error('Cannot load tables: No restaurant data');
                        return;
                    }
                    
                    console.log('Loading tables for restaurant:', this.restaurant.id);
                    this.tables = await TablesService.getTables(this.restaurant.id);
                    console.log('Tables loaded:', this.tables);
                    this.displayTables();
                } catch (error) {
                    console.error('Error loading tables:', error);
                    this.showNotification('Error loading tables: ' + error.message, 'error');
                }
            }
    
            displayTables() {
    const container = document.getElementById('tablesContainer');
    
    if (this.tables.length === 0) {
        container.innerHTML = `
            <div class="col-span-full text-center py-12">
                <span class="material-symbols-outlined text-4xl text-gray-400 mb-4">table_restaurant</span>
                <p class="text-gray-500 dark:text-gray-400 text-lg">No tables found</p>
                <p class="text-gray-400 dark:text-gray-500 text-sm mt-2">Create your first table to get started</p>
            </div>
        `;
        return;
    }

    container.innerHTML = this.tables.map(table => `
        <div class="flex flex-col gap-4 rounded-xl bg-white dark:bg-gray-900/50 p-5 shadow-sm transition-shadow hover:shadow-md border border-gray-200 dark:border-gray-800">
            <div class="flex items-start justify-between">
                <div class="flex flex-col">
                    <p class="text-2xl font-bold text-gray-900 dark:text-white">Table ${table.table_number}</p>
                    <div class="mt-1.5 flex items-center gap-2">
                        <div class="size-2 rounded-full ${this.getStatusColor(table.status)}"></div>
                        <p class="text-sm font-medium ${this.getStatusTextColor(table.status)}">${this.formatStatus(table.status)}</p>
                    </div>
                    ${table.capacity ? `<p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Capacity: ${table.capacity} people</p>` : ''}
                </div>
                <div class="w-24 h-24 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center">
                    ${table.qr_code ? `
                        <img alt="QR Code for Table ${table.table_number}" class="w-full h-full object-cover rounded-md p-1" src="${table.qr_code}"/>
                    ` : `
                        <span class="material-symbols-outlined text-gray-400 text-3xl">qr_code_2</span>
                    `}
                </div>
            </div>
            <div class="mt-2 flex items-center gap-2">
                <button class="flex-1 flex items-center justify-center gap-2 h-9 px-4 rounded-md bg-background-light dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 text-sm font-medium transition-colors download-btn" data-table-id="${table.id}">
                    <span class="material-symbols-outlined text-base">download</span>
                    <span>Download</span>
                </button>
                <button class="flex items-center justify-center size-9 rounded-md bg-background-light dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors edit-btn" data-table-id="${table.id}">
                    <span class="material-symbols-outlined text-base">edit</span>
                </button>
                <button class="flex items-center justify-center size-9 rounded-md bg-background-light dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-red-100 dark:hover:bg-red-900/50 hover:text-red-600 dark:hover:text-red-400 transition-colors delete-btn" data-table-id="${table.id}">
                    <span class="material-symbols-outlined text-base">delete</span>
                </button>
            </div>
        </div>
    `).join('');

    // Add event listeners to buttons
    this.attachTableEventListeners();
}
    
            attachTableEventListeners() {
                // Download buttons
                document.querySelectorAll('.download-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const tableId = button.getAttribute('data-table-id');
                        this.downloadQRCode(tableId);
                    });
                });
    
                // Edit buttons
                document.querySelectorAll('.edit-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const tableId = button.getAttribute('data-table-id');
                        this.editTable(tableId);
                    });
                });
    
                // Delete buttons
                document.querySelectorAll('.delete-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const tableId = button.getAttribute('data-table-id');
                        this.deleteTable(tableId);
                    });
                });
            }
    
            getStatusColor(status) {
                switch (status) {
                    case 'available': return 'bg-green-500';
                    case 'occupied': return 'bg-red-500';
                    case 'reserved': return 'bg-yellow-500';
                    case 'maintenance': return 'bg-gray-500';
                    default: return 'bg-gray-400';
                }
            }
    
            getStatusTextColor(status) {
                switch (status) {
                    case 'available': return 'text-green-600 dark:text-green-400';
                    case 'occupied': return 'text-red-600 dark:text-red-400';
                    case 'reserved': return 'text-yellow-600 dark:text-yellow-400';
                    case 'maintenance': return 'text-gray-600 dark:text-gray-400';
                    default: return 'text-gray-600 dark:text-gray-400';
                }
            }
    
            formatStatus(status) {
                switch (status) {
                    case 'available': return 'Available';
                    case 'occupied': return 'Occupied';
                    case 'reserved': return 'Reserved';
                    case 'maintenance': return 'Maintenance';
                    default: return status;
                }
            }
    
            setupEventListeners() {
                // Generate QR code button
                document.getElementById('generateQRBtn').addEventListener('click', () => {
                    this.showAddTableModal();
                });
    
                // Add table modal
                document.getElementById('cancelTableBtn').addEventListener('click', () => {
                    this.hideAddTableModal();
                });
    
                document.getElementById('addTableForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addTable();
                });
    
                // Edit table modal
                document.getElementById('cancelEditTableBtn').addEventListener('click', () => {
                    this.hideEditTableModal();
                });
    
                document.getElementById('editTableForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.updateTable();
                });
    
                // Search functionality
                document.getElementById('searchInput').addEventListener('input', (e) => {
                    this.searchTables(e.target.value);
                });
            }
    
            showAddTableModal() {
                document.getElementById('addTableModal').classList.remove('hidden');
            }
    
            hideAddTableModal() {
                document.getElementById('addTableModal').classList.add('hidden');
                document.getElementById('addTableForm').reset();
            }
    
            showEditTableModal() {
                document.getElementById('editTableModal').classList.remove('hidden');
            }
    
            hideEditTableModal() {
                document.getElementById('editTableModal').classList.add('hidden');
                document.getElementById('editTableForm').reset();
            }
    
            async addTable() {
                const tableNumber = document.getElementById('tableNumber').value;
                const capacity = parseInt(document.getElementById('tableCapacity').value);
    
                try {
                    if (!this.restaurant) {
                        this.showNotification('No restaurant data available', 'error');
                        return;
                    }
    
                    // Create table data without location field
                    const tableData = {
                        restaurant_id: this.restaurant.id,
                        table_number: tableNumber,
                        capacity: capacity,
                        status: 'available'
                    };
    
                    const newTable = await TablesService.createTable(tableData);
    
                    this.tables.push(newTable);
                    this.displayTables();
                    this.hideAddTableModal();
                    this.showNotification('Table added successfully!', 'success');
                } catch (error) {
                    console.error('Error adding table:', error);
                    this.showNotification('Error adding table: ' + error.message, 'error');
                }
            }
    
            async editTable(tableId) {
                const table = this.tables.find(t => t.id === tableId);
                if (!table) {
                    this.showNotification('Table not found', 'error');
                    return;
                }
    
                // Populate the edit form
                document.getElementById('editTableId').value = table.id;
                document.getElementById('editTableNumber').value = table.table_number;
                document.getElementById('editTableCapacity').value = table.capacity || '';
                document.getElementById('editTableStatus').value = table.status || 'available';
    
                this.showEditTableModal();
            }
    
            async updateTable() {
                const tableId = document.getElementById('editTableId').value;
                const tableNumber = document.getElementById('editTableNumber').value;
                const capacity = parseInt(document.getElementById('editTableCapacity').value);
                const status = document.getElementById('editTableStatus').value;
    
                try {
                    // Update table data without location field
                    const updateData = {
                        table_number: tableNumber,
                        capacity: capacity,
                        status: status
                    };
    
                    const updatedTable = await TablesService.updateTable(tableId, updateData);
    
                    // Update local state
                    const index = this.tables.findIndex(t => t.id === tableId);
                    if (index !== -1) {
                        this.tables[index] = updatedTable;
                    }
    
                    this.displayTables();
                    this.hideEditTableModal();
                    this.showNotification('Table updated successfully!', 'success');
                } catch (error) {
                    console.error('Error updating table:', error);
                    this.showNotification('Error updating table: ' + error.message, 'error');
                }
            }
    
            async deleteTable(tableId) {
                if (!confirm('Are you sure you want to delete this table? This action cannot be undone.')) {
                    return;
                }
    
                try {
                    await TablesService.deleteTable(tableId);
                    
                    // Remove from local state
                    this.tables = this.tables.filter(t => t.id !== tableId);
                    
                    this.displayTables();
                    this.showNotification('Table deleted successfully!', 'success');
                } catch (error) {
                    console.error('Error deleting table:', error);
                    this.showNotification('Error deleting table: ' + error.message, 'error');
                }
            }
    
            async downloadQRCode(tableId) {
        try {
            const table = this.tables.find(t => t.id === tableId);
            if (!table) {
                this.showNotification('Table not found', 'error');
                return;
            }

            // Generate QR code data URL
            const qrCodeDataUrl = await this.generateQRCodeDataUrl(tableId);
            
            // Create download link
            const link = document.createElement('a');
            link.href = qrCodeDataUrl;
            link.download = `table-${table.table_number}-qr-code.png`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            this.showNotification('QR code downloaded successfully!', 'success');
        } catch (error) {
            console.error('Error downloading QR code:', error);
            this.showNotification('Error downloading QR code. Please try again.', 'error');
        }
    }

    generateQRCodeDataUrl(tableId) {
    return new Promise((resolve, reject) => {
        try {
            // Get the current URL
            const currentUrl = new URL(window.location.href);
            
            // Construct the correct customer menu URL
            // Since you're running on localhost:3000, use the correct path
            const customerMenuUrl = `${currentUrl.origin}/customer/menu?table=${tableId}`;
            
            console.log('Generating QR code for customer URL:', customerMenuUrl);
            
            // Use QR code API
            const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(customerMenuUrl)}`;
            
            // Convert to data URL
            const img = new Image();
            img.crossOrigin = "Anonymous";
            img.onload = function() {
                const canvas = document.createElement('canvas');
                canvas.width = img.width;
                canvas.height = img.height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0);
                resolve(canvas.toDataURL('image/png'));
            };
            img.onerror = () => reject(new Error('Failed to load QR code image'));
            img.src = qrCodeUrl;
        } catch (error) {
            reject(error);
        }
    });
}

    
searchTables(query) {
    if (!query.trim()) {
        this.displayTables();
        return;
    }

    const filteredTables = this.tables.filter(table => 
        table.table_number.toLowerCase().includes(query.toLowerCase()) ||
        table.status.toLowerCase().includes(query.toLowerCase())
    );

    const container = document.getElementById('tablesContainer');
    
    if (filteredTables.length === 0) {
        container.innerHTML = `
            <div class="col-span-full text-center py-12">
                <span class="material-symbols-outlined text-4xl text-gray-400 mb-4">search_off</span>
                <p class="text-gray-500 dark:text-gray-400 text-lg">No tables matching "${query}"</p>
            </div>
        `;
        return;
    }

    container.innerHTML = filteredTables.map(table => `
        <div class="flex flex-col gap-4 rounded-xl bg-white dark:bg-gray-900/50 p-5 shadow-sm transition-shadow hover:shadow-md border border-gray-200 dark:border-gray-800">
            <div class="flex items-start justify-between">
                <div class="flex flex-col">
                    <p class="text-2xl font-bold text-gray-900 dark:text-white">Table ${table.table_number}</p>
                    <div class="mt-1.5 flex items-center gap-2">
                        <div class="size-2 rounded-full ${this.getStatusColor(table.status)}"></div>
                        <p class="text-sm font-medium ${this.getStatusTextColor(table.status)}">${this.formatStatus(table.status)}</p>
                    </div>
                    ${table.capacity ? `<p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Capacity: ${table.capacity} people</p>` : ''}
                </div>
                <div class="w-24 h-24 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center">
                    ${table.qr_code ? `
                        <img alt="QR Code for Table ${table.table_number}" class="w-full h-full object-cover rounded-md p-1" src="${table.qr_code}"/>
                    ` : `
                        <span class="material-symbols-outlined text-gray-400 text-3xl">qr_code_2</span>
                    `}
                </div>
            </div>
            <div class="mt-2 flex items-center gap-2">
                <button class="flex-1 flex items-center justify-center gap-2 h-9 px-4 rounded-md bg-background-light dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 text-sm font-medium transition-colors download-btn" data-table-id="${table.id}">
                    <span class="material-symbols-outlined text-base">download</span>
                    <span>Download</span>
                </button>
                <button class="flex items-center justify-center size-9 rounded-md bg-background-light dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors edit-btn" data-table-id="${table.id}">
                    <span class="material-symbols-outlined text-base">edit</span>
                </button>
                <button class="flex items-center justify-center size-9 rounded-md bg-background-light dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-red-100 dark:hover:bg-red-900/50 hover:text-red-600 dark:hover:text-red-400 transition-colors delete-btn" data-table-id="${table.id}">
                    <span class="material-symbols-outlined text-base">delete</span>
                </button>
            </div>
        </div>
    `).join('');

    // Reattach event listeners
    this.attachTableEventListeners();
}
    
            showNotification(message, type = 'info') {
                // Remove existing notification
                const existingNotification = document.querySelector('.notification-toast');
                if (existingNotification) {
                    existingNotification.remove();
                }
    
                // Create notification
                const notification = document.createElement('div');
                notification.className = `notification-toast fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg ${
                    type === 'success' ? 'bg-green-500 text-white' : 
                    type === 'error' ? 'bg-red-500 text-white' : 
                    'bg-blue-500 text-white'
                }`;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                // Auto remove after 5 seconds
                setTimeout(() => {
                    notification.remove();
                }, 5000);
            }
    
            async logout() {
                try {
                    await AuthService.logout();
                    window.location.href = 'login.html';
                } catch (error) {
                    console.error('Logout error:', error);
                }
            }
        }
    
        // Initialize table management
        const tableManagement = new TableManagement();
        window.tableManagement = tableManagement;
    </script>
</body>
</html>